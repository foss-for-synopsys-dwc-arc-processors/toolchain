

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>SecureShield Programming &mdash; GNU Toolchain for ARC User Manual 2022.09 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/style_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Sanitizers support for ARC" href="sanitizers.html" />
    <link rel="prev" title="Using JLI Instructions with GNU" href="jli.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> GNU Toolchain for ARC User Manual
          

          
          </a>

          
            
            
              <div class="version">
                2022.09
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../baremetal/index.html">Building baremetal applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../baremetal/index.html#debugging-baremetal-applications">Debugging baremetal applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linux/index.html">Linux applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other/index.html">Other</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ide/index.html">ARC GNU IDE</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">GCC documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#arc-specific-tech-discussion">ARC specific tech discussion</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="custom-instructions.html">Custom instructions: what and how</a></li>
<li class="toctree-l3"><a class="reference internal" href="extensions-support.html">GCC’s support for ARC custom extensions</a></li>
<li class="toctree-l3"><a class="reference internal" href="64bit.html">Impact of 64-bit integral operation on GCC toolchain</a></li>
<li class="toctree-l3"><a class="reference internal" href="jli.html">Using JLI Instructions with GNU</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">SecureShield Programming</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#secureshield-api">SecureShield API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#identifying-the-secure-callable-apis">Identifying the Secure-Callable APIs</a></li>
<li class="toctree-l4"><a class="reference internal" href="#programming-cautions">Programming Cautions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sanitizers.html">Sanitizers support for ARC</a></li>
<li class="toctree-l3"><a class="reference internal" href="small-data.html">Working with small data section</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#from-mwdt-to-gcc">From MWDT to GCC</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#improving-gcc-output">Improving GCC output</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer/index.html">Information for Toolchain maintainers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently asked questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../man-pages.html">GNU man pages</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GNU Toolchain for ARC User Manual</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="index.html">GCC documentation</a> &raquo;</li>
        
      <li>SecureShield Programming</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/gcc/secure-shield.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section id="secureshield-programming">
<h1>SecureShield Programming<a class="headerlink" href="#secureshield-programming" title="Permalink to this heading">¶</a></h1>
<section id="secureshield-api">
<h2>SecureShield API<a class="headerlink" href="#secureshield-api" title="Permalink to this heading">¶</a></h2>
<p>A secure-callable API is a set of functions executing in secure mode that can be
called from code executing in normal mode. The processor contains a special
function call instruction, SJLI, that the compiler uses to implement a
secure-mode API. This instruction transfers execution from normal mode to secure
mode. Any other call or jump into secure mode from normal mode results in a
processor exception.</p>
<p>The GNU tools support a secure-callable API with a two-executable approach:</p>
<ul class="simple">
<li><p>One linked executable contains the secure-mode code;</p></li>
<li><p>The second linked executable contains the normal-mode code.</p></li>
</ul>
<p>The normal-mode code is compiled normally—no special code is generated for calls
to the secure-mode API.  However, such calls are resolved by the linker in the
normal executable with special function entry points that transfer control to
the normal executable using the SJLI instruction. In the secure-mode executable,
functions that are designate as belonging to the secure API need an index into
the SJLI table. Also the runtime initialization for the secure-mode needs to be
carried on by the user.</p>
</section>
<section id="identifying-the-secure-callable-apis">
<h2>Identifying the Secure-Callable APIs<a class="headerlink" href="#identifying-the-secure-callable-apis" title="Permalink to this heading">¶</a></h2>
<p>To indicate to the compiler that a secure-mode function is callable from normal
mode, you can use <code class="docutils literal notranslate"><span class="pre">__attribute__((secure_call</span> <span class="pre">(IndexNumber)))</span></code> with
secure-callable function. Where <code class="docutils literal notranslate"><span class="pre">IndexNumber</span></code> is the entry of that particular
function into the SJLI table.</p>
</section>
<section id="programming-cautions">
<h2>Programming Cautions<a class="headerlink" href="#programming-cautions" title="Permalink to this heading">¶</a></h2>
<p>Using function pointer of a secure call function is not supported. However, one
can make a stub which can be called indirectly, the stub itself calls the secure
call normally.</p>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h2>
<p>Let us consider the following example:</p>
<div class="highlight-c notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>

<span class="k">extern</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">foo</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">__attribute__</span><span class="p">((</span><span class="n">secure_call</span><span class="p">(</span><span class="mi">2</span><span class="p">)));</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">bar</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="n">printf</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">foo</span><span class="w"> </span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span><span class="w"> </span><span class="nf">bar2</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">foo</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Where function <code class="docutils literal notranslate"><span class="pre">foo()</span></code> is an external secure function located at index 2 in
the SJLI table.</p>
<p>The result is:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">.</span><span class="n">cpu</span> <span class="n">EM</span>
<span class="o">.</span><span class="n">section</span>     <span class="o">.</span><span class="n">rodata</span><span class="o">.</span><span class="n">str1</span><span class="mf">.4</span><span class="p">,</span><span class="s2">&quot;aMS&quot;</span><span class="p">,</span><span class="nd">@progbits</span><span class="p">,</span><span class="mi">1</span>
<span class="o">.</span><span class="n">align</span> <span class="mi">4</span>
      <span class="o">.</span><span class="n">LC0</span><span class="p">:</span>
         <span class="o">.</span><span class="n">string</span>     <span class="s2">&quot;</span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span>
         <span class="o">.</span><span class="n">section</span>    <span class="o">.</span><span class="n">text</span>
         <span class="o">.</span><span class="n">align</span> <span class="mi">4</span>
         <span class="o">.</span><span class="k">global</span>     <span class="n">bar</span>
         <span class="o">.</span><span class="n">type</span>       <span class="n">bar</span><span class="p">,</span> <span class="nd">@function</span>
      <span class="n">bar</span><span class="p">:</span>
         <span class="n">push_s</span> <span class="n">blink</span>
         <span class="n">mov_s</span> <span class="n">r0</span><span class="p">,</span><span class="mi">100</span>        <span class="p">;</span><span class="mi">3</span>
         <span class="n">sjli</span>  <span class="mi">2</span>     <span class="p">;</span> <span class="nd">@foo</span>
         <span class="n">mov_s</span> <span class="n">r1</span><span class="p">,</span><span class="n">r0</span> <span class="p">;</span><span class="mi">4</span>
         <span class="n">mov_s</span> <span class="n">r0</span><span class="p">,</span><span class="o">@.</span><span class="n">LC0</span>      <span class="p">;</span><span class="mi">14</span>
         <span class="n">bl</span> <span class="nd">@printf</span><span class="p">;</span><span class="mi">1</span>
         <span class="n">pop_s</span> <span class="n">blink</span>
         <span class="n">j_s</span><span class="o">.</span><span class="n">d</span> <span class="p">[</span><span class="n">blink</span><span class="p">]</span>
         <span class="n">mov_s</span> <span class="n">r0</span><span class="p">,</span><span class="mi">0</span>  <span class="p">;</span><span class="mi">3</span>
         <span class="o">.</span><span class="n">size</span>       <span class="n">bar</span><span class="p">,</span> <span class="o">.-</span><span class="n">bar</span>
         <span class="o">.</span><span class="n">align</span> <span class="mi">4</span>
         <span class="o">.</span><span class="k">global</span>     <span class="n">bar2</span>
         <span class="o">.</span><span class="n">type</span>       <span class="n">bar2</span><span class="p">,</span> <span class="nd">@function</span>
      <span class="n">bar2</span><span class="p">:</span>
         <span class="n">push_s</span> <span class="n">blink</span>
         <span class="n">mov_s</span> <span class="n">r0</span><span class="p">,</span><span class="mi">100</span>        <span class="p">;</span><span class="mi">3</span>
         <span class="n">sjli</span>  <span class="mi">2</span>     <span class="p">;</span> <span class="nd">@foo</span>
         <span class="n">pop_s</span> <span class="n">blink</span>
         <span class="n">j_s</span> <span class="p">[</span><span class="n">blink</span><span class="p">]</span>
          <span class="o">.</span><span class="n">size</span>      <span class="n">bar2</span><span class="p">,</span> <span class="o">.-</span><span class="n">bar2</span>
</pre></div>
</div>
<p>Where, we can easily spot the call to <code class="docutils literal notranslate"><span class="pre">foo()</span></code> function via <code class="docutils literal notranslate"><span class="pre">SJLI</span></code> instruction.</p>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="sanitizers.html" class="btn btn-neutral float-right" title="Sanitizers support for ARC" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="jli.html" class="btn btn-neutral float-left" title="Using JLI Instructions with GNU" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016-2022, Synopsys.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>